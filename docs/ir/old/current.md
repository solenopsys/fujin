# Команды IR (текущий факт)

## OpKind — бинарный формат (compiler/src/binary_writer.zig)

**Константы**
| Имя          | Код | Описание            |
|--------------|-----|---------------------|
| const_i64    | 0   | Константа i64       |
| const_i32    | 1   | Константа i32       |
| const_f64    | 2   | Константа f64       |
| const_string | 3   | Константа строка    |
| const_true   | 4   | true                |
| const_false  | 5   | false               |
| const_null   | 6   | null                |

**Локальные**
| Имя         | Код | Описание                         |
|-------------|-----|----------------------------------|
| load_local  | 7   | Загрузить локальную переменную   |
| store_local | 8   | Сохранить в локальную переменную |

**Арифметика**
| Имя      | Код | Описание      |
|----------|-----|---------------|
| add_i64  | 9   | Сложение i64  |
| sub_i64  | 10  | Вычитание i64 |
| mul_i64  | 11  | Умножение i64 |
| div_i64  | 12  | Деление i64   |
| mod_i64  | 13  | mod i64       |
| pow_i64  | 14  | Степень i64   |
| add_i32  | 15  | Сложение i32  |
| sub_i32  | 16  | Вычитание i32 |
| mul_i32  | 17  | Умножение i32 |
| div_i32  | 18  | Деление i32   |
| mod_i32  | 19  | mod i32       |
| pow_i32  | 20  | Степень i32   |
| add_f64  | 21  | Сложение f64  |
| sub_f64  | 22  | Вычитание f64 |
| mul_f64  | 23  | Умножение f64 |
| div_f64  | 24  | Деление f64   |
| mod_f64  | 25  | mod f64       |
| pow_f64  | 26  | Степень f64   |

**Сравнения и логика**
| Имя         | Код | Описание            |
|-------------|-----|---------------------|
| eq          | 30  | Равно               |
| neq         | 31  | Не равно            |
| lt          | 32  | Меньше              |
| lte         | 33  | Меньше либо равно   |
| gt          | 34  | Больше              |
| gte         | 35  | Больше либо равно   |
| logical_not | 40  | Логическое не       |
| logical_and | 41  | Логическое и        |
| logical_or  | 42  | Логическое или      |

**Унарные / инкременты**
| Имя          | Код | Описание                |
|--------------|-----|-------------------------|
| neg_i64      | 43  | Унарный минус i64       |
| neg_i32      | 44  | Унарный минус i32       |
| neg_f64      | 45  | Унарный минус f64       |
| plus_i64     | 46  | Унарный плюс i64        |
| plus_i32     | 47  | Унарный плюс i32        |
| plus_f64     | 48  | Унарный плюс f64        |
| inc_i64      | 49  | ++ i64 (префикс)        |
| inc_i32      | 50  | ++ i32 (префикс)        |
| dec_i64      | 51  | -- i64 (префикс)        |
| dec_i32      | 52  | -- i32 (префикс)        |
| post_inc_i64 | 53  | ++ i64 (постфикс)       |
| post_inc_i32 | 54  | ++ i32 (постфикс)       |
| post_dec_i64 | 55  | -- i64 (постфикс)       |
| post_dec_i32 | 56  | -- i32 (постфикс)       |

**Контроль / IO**
| Имя          | Код | Описание                   |
|--------------|-----|----------------------------|
| emit         | 60  | Отправить сообщение        |
| return_value | 62  | Возврат со значением       |
| return_void  | 63  | Возврат без значения       |
| assert_op    | 64  | Assert                     |

**Объекты и доступ**
| Имя            | Код | Описание                       |
|----------------|-----|--------------------------------|
| create_object  | 65  | Создать объект                 |
| member_access  | 66  | Доступ obj.prop                |
| subscript      | 67  | Доступ obj[idx] или arr[idx]   |
| unknown        | 255 | Резерв/неизвестная операция    |

## OpType — исполнение (interpreter/src/ir.zig)

**Константы и параметры**
| Команда  | Описание                        |
|----------|---------------------------------|
| const_op | Константа в out                 |
| param    | Аргумент или константа по имени |

**Арифметика / логика**
| Команда                   | Описание                      |
|---------------------------|-------------------------------|
| add, sub, mul, div, mod, pow | Бинарные операции          |
| eq, neq, gt, gte, lt, lte    | Сравнения                   |
| and_op, or_op, not           | Логика                      |
| neg, plus, inc, dec, post_inc, post_dec | Унарные/инкременты |

**Контроль**
| Команда    | Описание                    |
|------------|-----------------------------|
| assert_op  | Проверка условия            |
| return_op  | Возврат значения/void       |
| branch     | Ветвление if/else           |
| emit       | Отправка сообщения (возврат значения) |

**Объекты**
| Команда        | Описание                 |
|----------------|--------------------------|
| create_object  | Объект из полей          |
| member_access  | obj.prop                 |
| subscript      | obj[idx]/arr[idx]        |
| get_property   | obj[prop]                |
| set_property   | obj[prop] = val          |
| get_path       | Доступ по пути           |

**Массивы**
| Команда      | Описание           |
|--------------|--------------------|
| create_array | Массив из регистров|
| array_length | Длина массива      |
| array_get    | Чтение массива     |
| array_set    | Запись массива     |

**Типы**
| Команда   | Описание              |
|-----------|-----------------------|
| cast      | Приведение типа       |
| typeof_op | Тип значения строкой  |

Разрывы факта:
- В OpKind нет массивных операций (`create_array/array_get/array_set/array_length`) — они есть только в интерпретаторе на `ir.Value`.
- OpKind содержит `load_local/store_local` и pow/инкременты по числам; интерпретатор мапит их в свои обобщённые операции. 
